<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YouTube Swiper 完整範例</title>
  <!-- Google Tag Manager -->
  <script>(function (w, d, s, l, i) {
      w[l] = w[l] || []; w[l].push({
        'gtm.start':
          new Date().getTime(), event: 'gtm.js'
      }); var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
          'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-WZQ9J3N3');</script>
  <!-- End Google Tag Manager -->
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-W3PMKQD1NS"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-W3PMKQD1NS');
  </script>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Swiper CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css" />
  <style>
    .swiper {
      width: 100%;
      padding-top: 20px;
      padding-bottom: 50px;
    }

    .swiper-slide {
      width: 45%;
      height: auto;
    }

    .video-swiper__card {
      position: relative;
      width: 100%;
      padding-bottom: 56.25%;
      /* 16:9 比例 */
      background-color: #f8f9fa;
      border-radius: 8px;
      overflow: hidden;
      cursor: pointer;
    }

    .video-thumbnail {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .play-button {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 60px;
      height: 60px;
      background-color: rgba(255, 0, 0, 0.8);
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
      font-size: 24px;
      transition: all 0.3s ease;
    }

    .video-swiper__card:hover .play-button {
      background-color: rgba(255, 0, 0, 1);
      transform: translate(-50%, -50%) scale(1.1);
    }

    .player-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 2;
    }

    .video-title {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 8px;
      font-size: 14px;
      z-index: 1;
    }
  </style>
</head>

<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WZQ9J3N3" height="0" width="0"
      style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->
  <div class="container mt-5">
    <h1 class="text-center mb-4">YouTube 影片輪播</h1>

    <div class="swiper video-swiper">
      <div class="swiper-wrapper">
        <!-- 影片幻燈片 - 使用 data-video-id 存儲 YouTube 影片 ID -->
        <div class="swiper-slide">
          <div class="video-swiper__card" data-video-id="dQw4w9WgXcQ"
            data-title="Rick Astley - Never Gonna Give You Up">
            <img src="https://img.youtube.com/vi/dQw4w9WgXcQ/maxresdefault.jpg" alt="影片縮略圖" class="video-thumbnail">
            <div class="play-button">▶</div>
            <div class="video-title">Rick Astley - Never Gonna Give You Up</div>
          </div>
        </div>
        <div class="swiper-slide">
          <div class="video-swiper__card" data-video-id="jNQXAC9IVRw" data-title="Me at the zoo">
            <img src="https://img.youtube.com/vi/jNQXAC9IVRw/maxresdefault.jpg" alt="影片縮略圖" class="video-thumbnail">
            <div class="play-button">▶</div>
            <div class="video-title">Me at the zoo</div>
          </div>
        </div>
        <div class="swiper-slide">
          <div class="video-swiper__card" data-video-id="9bZkp7q19f0" data-title="PSY - GANGNAM STYLE">
            <img src="https://img.youtube.com/vi/9bZkp7q19f0/maxresdefault.jpg" alt="影片縮略圖" class="video-thumbnail">
            <div class="play-button">▶</div>
            <div class="video-title">PSY - GANGNAM STYLE</div>
          </div>
        </div>
        <div class="swiper-slide">
          <div class="video-swiper__card" data-video-id="5qap5aO4i9A" data-title="lofi hip hop radio">
            <img src="https://img.youtube.com/vi/5qap5aO4i9A/maxresdefault.jpg" alt="影片縮略圖" class="video-thumbnail">
            <div class="play-button">▶</div>
            <div class="video-title">lofi hip hop radio</div>
          </div>
        </div>
        <div class="swiper-slide">
          <div class="video-swiper__card" data-video-id="J9go2nj6b3M" data-title="THE BATMAN">
            <img src="https://img.youtube.com/vi/J9go2nj6b3M/maxresdefault.jpg" alt="影片縮略圖" class="video-thumbnail">
            <div class="play-button">▶</div>
            <div class="video-title">THE BATMAN</div>
          </div>
        </div>
      </div>
      <div class="swiper-pagination"></div>
      <div class="swiper-button-next"></div>
      <div class="swiper-button-prev"></div>
    </div>
  </div>

  <!-- Bootstrap JS Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Swiper JS -->
  <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>

  <script>
    // 初始化 Swiper
    let swiper;

    // 播放器實例的對象，用來存儲所有創建的播放器
    const players = {};

    // 1. 首先載入 YouTube IFrame API
    function loadYouTubeAPI() {
      const tag = document.createElement('script');
      tag.src = "https://www.youtube.com/iframe_api";
      const firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    }

    // 2. API 準備就緒時會自動調用此函數
    function onYouTubeIframeAPIReady() {
      console.log('YouTube API 已載入完成');
      // 初始化所有視頻卡片
      initLoadVideo();

      // 初始化 Swiper
      initSwiper();
    }

    // 3. 初始化所有視頻卡片，為它們添加點擊事件
    function initLoadVideo() {
      const videoCards = document.querySelectorAll('.video-swiper__card');

      if (videoCards.length === 0) return;

      videoCards.forEach(card => {
        // 為卡片添加點擊事件
        card.addEventListener('click', function () {
          const videoId = this.dataset.videoId;
          const videoTitle = this.dataset.title;

          // 檢查是否已經包含播放器容器
          let playerContainer = this.querySelector('.player-container');

          // 如果沒有容器，創建一個
          if (!playerContainer) {
            // 為每個卡片創建一個唯一ID
            const uniqueId = 'player-' + Math.random().toString(36).substr(2, 9);

            playerContainer = document.createElement('div');
            playerContainer.id = uniqueId;
            playerContainer.classList.add('player-container');

            // 將容器添加到卡片中
            this.appendChild(playerContainer);

            // 創建新播放器
            createPlayer(uniqueId, videoId);

            // 隱藏縮略圖和播放按鈕
            const thumbnail = this.querySelector('.video-thumbnail');
            const playButton = this.querySelector('.play-button');
            if (thumbnail) thumbnail.style.display = 'none';
            if (playButton) playButton.style.display = 'none';
          } else {
            // 如果容器已存在，檢查播放器是否已創建
            const playerId = playerContainer.id;
            if (players[playerId]) {
              players[playerId].loadVideoById(videoId);
              players[playerId].playVideo();
            } else {
              createPlayer(playerId, videoId);
            }
          }
        });
      });
    }

    // 4. 創建 YouTube 播放器
    function createPlayer(containerId, videoId) {
      // 暫停所有其他播放器
      pauseAllPlayers();

      // 創建播放器
      players[containerId] = new YT.Player(containerId, {
        height: '100%',
        width: '100%',
        videoId: videoId,
        playerVars: {
          'autoplay': 1,         // 自動播放
          'controls': 1,         // 顯示控制項
          'rel': 0,              // 不顯示相關視頻
          'playsinline': 1,      // 在 iOS 設備上內嵌播放而非全屏
          'modestbranding': 1,   // 隱藏 YouTube 標誌
          'fs': 1,               // 顯示全屏按鈕
          'iv_load_policy': 3    // 不顯示視頻註釋
        },
        events: {
          'onReady': onPlayerReady,
          'onStateChange': onPlayerStateChange
        }
      });
    }

    // 5. 播放器準備就緒時的回調
    function onPlayerReady(event) {
      // 播放器準備好後立即播放
      event.target.playVideo();
    }

    // 6. 播放器狀態改變時的回調
    function onPlayerStateChange(event) {
      // 可以根據需要處理不同的播放器狀態
      // YT.PlayerState.ENDED       0
      // YT.PlayerState.PLAYING     1
      // YT.PlayerState.PAUSED      2
      // YT.PlayerState.BUFFERING   3
      // YT.PlayerState.CUED        5
    }

    // 7. 初始化 Swiper
    function initSwiper() {
      swiper = new Swiper(".video-swiper", {
        slidesPerView: 1,
        spaceBetween: 30,
        pagination: {
          el: ".swiper-pagination",
          clickable: true,
        },
        navigation: {
          nextEl: ".swiper-button-next",
          prevEl: ".swiper-button-prev",
        },
        breakpoints: {
          // 當視窗寬度小於等於 768px
          768: {
            slidesPerView: 2,
            spaceBetween: 20,
          },
          // 當視窗寬度小於等於 576px
          576: {
            slidesPerView: 1,
            spaceBetween: 10,
          }
        },
        on: {
          slideChange: function () {
            // 在滑動改變時暫停所有播放器
            pauseAllPlayers();
          },
          sliderMove: function () {
            // 在滑動過程中暫停所有播放器
            pauseAllPlayers();
          }
        }
      });
    }

    // 8. 暫停所有播放器
    function pauseAllPlayers() {
      Object.values(players).forEach(player => {
        if (player && typeof player.pauseVideo === 'function') {
          player.pauseVideo();
        }
      });
    }

    // 初始加載 YouTube API
    document.addEventListener('DOMContentLoaded', loadYouTubeAPI);
  </script>
</body>

</html>
